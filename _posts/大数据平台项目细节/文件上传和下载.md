### 上传文件
获取文件的保存目录

```java
private String path = System.getProperty("user.dir") + "\\src\\main\\resources\\static\\uploadFile\\";
```

- 使用`MultipartFile file`接收前端上传文件
- 建立后台存储的文件`File elem = new File(path + folderName + "\\" + fileName);
- 如果目录不存在 `elem.getParentFile().mkdirs();`
- `file.transferTo(elem);`

### 下载文件
获取到文件`File file = new File(path + folderName + "\\" + fileName);`

设置response的属性
```java
response.reset();
response.setContentType("application/octet-stream");
response.setCharacterEncoding("utf-8");
response.setContentLength((int) file.length());
response.setHeader("Content-Disposition", "attachment;filename=" + fileName);
```

用file的BufferedInputStream读取数据，写到response的outputStream里

### 怎么处理大文件上传？
分片上传
[参考](https://segmentfault.com/a/1190000038588015)
在JavaScript中，文件FIle对象是Blob对象的子类，Blob对象包含一个重要的方法slice，通过这个方法，我们就可以对二进制文件进行拆分。

断点续传：可以从已经上传部分开始继续上传未完成的部分，而没有必要从头开始上传，节省上传时间。
- 可以通过locaStorage等方式保存在前端浏览器中，这种方式不依赖于服务端，实现起来也比较方便，缺点在于如果用户清除了本地文件，会导致上传记录丢失；
- 服务端本身知道哪些切片已经上传，因此可以由服务端额外提供一个根据文件context查询已上传切片的接口，在上传文件前调用该文件的历史上传记录；

[springboot分片上传](https://cloud.tencent.com/developer/article/1541199)

- 后端有个conf文件记录已经上传的块号和没有上传的块号
- 上传前先获取是否上传过或者没有上传的块号
- 启动上传
- RandomAccessFile
- 用Redis来保存文件的上传信息

### 大文件下载
[参考](https://blog.csdn.net/weixin_52210557/article/details/124097574)
- 前端先向服务器发一个请求，获得文件的长度
- 前端分片请求部分文件，后端返回分片
- 前端下载完成后，合并文件