### 同步老成绩
- 启动一个定时器，扫描成绩表，如果有个字段为1，把这一行数据插入到老系统数据库，字段置为0
- quartz定时任务去拿待同步的数据，然后插入到老系统数据表

@Scheduled

加表锁
```sql
lock table user write;

insert into table_a(user, pwd, score) select username user, password pwd, score from table_b where flag = 0;

update table_b set falg = 1 where falg = 0;

unlock tables;
```

并发update时怎么解决幻读：[参考](https://www.cnblogs.com/jian0110/p/15080603.html)
- 普通的查询是快照读，是不会看到别的事务插入的数据的。因此， 幻读在“当前读”下才会出现（三个查询都是for update表示当前读）；
- RR隔离级别下为了解决“幻读”问题：“快照读”依靠MVCC控制，“当前读”通过间隙锁解决；
- 间隙锁和行锁合称next-key lock，每个next-key lock是**前开后闭**区间；
- 当索引失效或者说根本没有用索引的时候，行锁就会升级成表锁；

[datasource数据源配置](https://segmentfault.com/a/1190000040167879)
```java
@Configuration
public class DataSourceConfiguration {
    @Bean
    @ConfigurationProperties(prefix = "spring.datasource.primary")
    public DataSource primaryDataSource() {
        return DataSourceBuilder.create().build();
    }

    @Bean
    public JdbcTemplate JdbcTemplate(
            @Qualifier("primaryDataSource") DataSource primaryDataSource) {
        return new JdbcTemplate(primaryDataSource);
    }
```

```java
jdbcTemplate.update("delete from book where id = ?",id);
```

把一张表的数据拷贝到另一张表
```sql
INSERT INTO table2 ( name , price ) SELECT name , price  FROM table1  WHERE id=5
```

创建MySQL用户并给他赋权限
```sql
create user 'user1'@'%' identified by 'user1';
grant all privileges on db1.* to 'user1'@'%' with grant option;
grant SELECT on db1.* to 'user1'@'%' with grant option;
flush privileges;
```

### 刷新培养计划
refreshCultivationPlan

CultivationPlan【培养计划】->CourseSpecification【课程类别】->RelCourseSpecAndRepo【具体的课程】

**masterToPhd**：同步硕博连读**转博**同学的培养计划和成绩【博士角色会进入到这个方法】
- 通过身份证号能找到两个student实体
- 在masterToPhd函数的开始时先自动刷新对应硕士生的培养计划
- 把硕士阶段的成绩复制一遍变成博士阶段的成绩【通过setStudent绑定对应的学生实体】

**refreshCultivationPlanStatus**：重置培养计划，更改培养计划状态
改成初始或者通过状态，否决的也改成初始状态

**courseCategoryRefresh**：根据选课记录刷新培养计划
- 如果选课记录中一门课只有退课记录，从培养计划中删除这门课
- 判断要添加的课课程大类是否存在
	- 不存在的话，新建一个类别大类，把课程添加进去，添加学分
	- 存在的话进入那个大类，看课程在不在，不在就添加进去
	- 在其他大类里判断有没有这个课程，有的话就删除掉

**outsideCourseRefresh**：根据认定成绩记录刷新培养计划
- 筛选该生校外成绩表中通过审核的记录
- 将校外导入的课程添加入到培养计划

**oldCourseRefresh**：刷新老系统成绩
只针对通过的老系统成绩

**refreshByScore**：对于其他没有选课记录的成绩进行额外的刷新
- 包含专硕的通过成绩 或 硕博连读复制成绩需添加
